#!/bin/bash

clr_reset="\e[0m"
clr_info="\e[1;32m"
clr_warn="\e[1;33m"
clr_err="\e[1;31m"
clr_verb="\e[1;36m"
verbose=0
build_hostname="cephos"

function log_message()
{
  local log_level="$1"
  local log_color="$2"
  local log_text="$3"
  echo -e "[${log_color}${log_level}${clr_reset}] ${log_text}"
}

function log_verbose()
{
  local message="$1"
  if (( verbose ))
  then
    log_message "V" "${clr_verb}" "${message}"
  fi
}

function log_info()
{
  local message="$1"
  log_message "I" "${clr_info}" "${message}"
}

function log_wrn()
{
  local message="$1"
  log_message "W" "${clr_warn}" "${message}"
}

function log_err()
{
  local message="$1"
  log_message "E" "${clr_err}" "${message}"
}

function wrong_opt()
{
  local message="$1"
  log_err "${message}"
  usage
  exit 1
}

function log_cry()
{
  local message="$1"
  log_err "${message}"
  exit 1
}

function verbose_flag()
{
  if (( verbose ))
  then
    echo "-v"
  else
    echo " "
  fi
}

function usage()
{
  echo "${help_text}"
  exit 0
}

function ask_confirmation()
{
  local prompt_message=$1
  local user_input

  while true
  do
    echo -ne "[${clr_warn}?${clr_reset}] "
    read -r -p "${prompt_message} (y/n): " user_input
    case "${user_input}" in
      [Yy]) return 0 ;;
      [Nn]) exit 1   ;;
         *) log_wrn "Please enter 'y' or 'n'. Try again." ;;
    esac
  done
}

function check_user()
{
  local target_user="$1"
  if [[ "$(id -un)" != "${target_user}" ]]
  then
    log_err "Must be run as user ${target_user}"
    exit 1
  fi
}

function manage_service_state()
{
  local state="$1"
  local service="$2"
  log_verbose "Change service '${service}' satate to '${state}'"
  sudo systemctl ${state} --now ${service}.service
}
