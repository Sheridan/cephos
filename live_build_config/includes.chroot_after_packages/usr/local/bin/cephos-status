#!/usr/bin/env bash

. /usr/local/lib/cephos/base.sh.lib
. /usr/local/lib/cephos/config.sh.lib
. /usr/local/lib/cephos/cephos.sh.lib

read -r -d '' help_text <<EOF
CephOS Cluster Status Script

Options:
-h  Display this help message
-v  Enable verbose output
EOF
set -euo pipefail

# --- options parse ---
while getopts ":hv" opt
do
  case ${opt} in
    h) usage; exit 0 ;;
    v) verbose=1 ;;
   \?) wrong_opt "Error: unknown option -${OPTARG}" ;;
    :) wrong_opt "Error: option -${OPTARG} requires argument" ;;
  esac
done
# --- options parse ---
# --- main ---
check_user "cephos"

log_info "Local timesync status"
sudo chronyc sources
sudo chronyc tracking
sudo chronyc activity

log_info "Health"
sudo ceph health

# log_info "Pools"
# sudo ceph lspools

log_info "Using"
sudo ceph df

log_info "OSD tree"
sudo ceph osd tree

log_info "OSD df tree"
sudo ceph osd df tree

log_info "OSD perf"
sudo ceph osd perf

log_info "Pools stats"
sudo ceph osd pool stats

log_info "PG stats"
sudo ceph pg stat

log_info "MON stats"
sudo ceph mon stat

log_info "Cluster status"
sudo ceph -s
